#

[toc]

# HOOK 简介

HOOK 是 React16.8.0 之后出现

组件：分为两种

1. 无状态组件（函数组件）
2. 类组件

类组件中的麻烦：

1. this 指向问题

2. 繁琐的生命周期

3. 其他问题

HOOK 专门用于**增强函数组件的功能**（HOOK 在类组件中是不能使用的），函数组件理论上可以成为类组件的替代品

官方强调：没有必要更改已经完成的类组件，官方目前没有计划取消类组件，只是鼓励使用函数组件

HOOK（钩子）本质上是一个函数(命名上总是以 use 开头)，该函数可以挂载任何功能

HOOK 种类：

1. useState
2. useEffect
3. 指定要 Hook
4. useducer
5. useContext
6. useCallback
7. useMemo
8. useRef
9. useImperativeHandle
10. useLayoutEffect
11. useDebugValue
12. 其他...

# State Hook

State Hook 是一个在函数组件中使用的函数（useState），用于在函数组件中使用状态

> 在严格模式下，React 会调用你的初始值设定项函数两次  仅开发模式才会，这是为了方便调试工具

useState

- 函数有一个参数，这个参数的值表示状态的默认值
- 函数的返回值是一个数组，该数组一定包含两项
  - 第一项：当前状态的值
  - 第二项：改变状态的函数

```js
// 当改变n 后重新指向app组件 执行到useState后会先去看全局表格里面有没有这个引用 如果有直接拿过来如果没有就创建 
export default function App() {
    const [n, setN] = useState(0); //使用一个状态，该状态的默认值是0
    return <div>
        <button onClick={() => {
            setN(prevN => prevN - 1);
        }}>-</button>
        <span>{n}</span>
        <button onClick={() => {
            setN(prevN => prevN + 1);
        }}>+</button>
    </div>
}
```

一个函数组件中可以有多个状态，这种做法非常有利于横向切分关注点。


**注意的细节**

1. useState 最好写到函数的起始位置，便于阅读
2. useState 严禁出现在代码块（判断、循环）中
   - 这是由于所有 useState 声明的状态变量都在一个表格（相当于数组） 他们是利用下标索引来查找的 所以不能出现在判断和循环里面
   - useState实际上是使用了闭包的原理来实现的。在每次组件渲染时，useState都会返回一个包含当前状态值和更新状态值的数组，这个数组的引用将一直保留在内存中。在后续的渲染中，useState将会返回同一个数组，因此它可以实现状态的持久化，并且不会丢失之前的状态。
3. useState 返回的函数（数组的第二项），引用不变（节约内存空间）
4. 使用函数改变数据，若数据和之前的数据完全相等（使用 Object.is 比较），不会导致重新渲染，以达到优化效率的目的。
5. 使用函数改变数据，传入的值不会和原来的数据进行合并，而是直接替换。（**注意类组件的setState就是混合进去不是直接替换**）
6. 如果要实现强制刷新组件
   1. 类组件：使用 forceUpdate 函数
   2. 函数组件：使用一个空对象的 useState
7. **如果某些状态之间没有必然的联系，应该分化为不同的状态，而不要合并成一个对象**
8. 和类组件的状态一样，函数组件中改变状态可能是异步的（在 DOM 事件中），多个状态变化会合并以提高效率，此时，不能信任之前的状态，而应该使用回调函数的方式改变状态。如果状态变化要使用到之前的状态，尽量传递函数。
